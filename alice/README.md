
# Навык Алисы "Отправить на пейджер"

Так как сервис PagerStation в основном репозитории представляет собой по сути бэкенд, то его можно использовать в связке с другими устройствами. Например попробуем связать его с умными колонками Алисы.

Для этого создадим навык. Здесь предполагается, что в этот раздел зашли только самые упорные программисты, а значит особо не буду расписывать как что сделать.

Для начала нам нужно пройти всю установку и настройку сервиса PagerStation из основного README. А также придётся выставить Raspberry наружу в интернет, неважно как, через reverse proxy или напрямую. Естественно, тут будет нужен статический ip-адрес или некий динамический dns. Проверьте доступность Raspberry через интернет, открыв страницу http://my-ip/docs

Ещё нам нужно иметь Яндекс аккаунт, а также что-то на чём мы будем всё это проверять (колонка с Алисой или подобное).

Зарегистрируемся в облаке https://cloud.yandex.ru/, создадим платёжный аккаунт. Платить тут не нужно - код навыка будет размещён в "Функциях", а они бесплатны для обработки навыков Алисы.

## Установка

1. Заходим в консоль Яндекс-облака, создаём новую функцию. 
- имя и описание: любое
- среда выполнения: python312
- таймаут: 5сек
- точка входа: main.handle_event

2. Добавим переменные окружения
- API_URL: домен или ip-адрес, по которому вы выставили свою Raspberry наружу, например https://pagerapi.myhomeserver.ru (без слеша в конце);
- API_TOKEN: токен доступа к api, высвечивался в конце установки, см. основной README у репозитория;
- TZ: часовой пояс в виде "Asia/Nozokuznetsk";

3. Загрузим код функции. В репозитории в папке alice есть скрипт make_zip.sh. Выполним его, он создаст архив, который нужно будет загрузить в редактор функции ("Способ - ZIP-архив"). Сохраняем функцию.

**Переходим на Яндекс.Диалоги:** https://dialogs.yandex.ru/developer
1. Создаём диалог, придумываем имя активации, например "Отправить на пейджер";
2. Backend - выбираем "Функция в Яндекс Облаке", и выбираем нашу функцию;
3. Заполняем все остальные требуемые поля, сохраняем;

Жмём Опубликовать. Приватный навык будет доступен только на устройствах с вашим аккаунтом, основную модерацию проходить не будет, так что в течение минут 5 уже станет доступен.

## Как пользоваться?

1. Сказать активационную фразу, например "Алиса, запусти навык Отправить на пейджер";
2. При запуске навыка он проверит доступность Raspberry и валидность токена доступа. Если что-то будет не так - навык сообщит об этом;
3. Девушка спросит номер абонента - можно говорить любой текст и называть числа как угодно - все цифры будут поняты как один номер абонента. Например можно сказать "Одиннадцать двенадцать" или "Тысяча сто двенадцать" или "Один один один два", всё это будет номером 1112;
4. Далее спросят текст, вся фраза будет сохранена для отправки. Если всё будет успешно, навык отключится сам;

## Проблемы и ограничения
Самая первая версия Raspberry Pi (2013 года) может сильно долго обрабатывать запрос по веб. Для навыка Алисы критично чтобы функция отрабатывала не дольше чем за 4.5 секунды, поэтому на этой версии Raspberry иногда бывают сбросы навыка по таймауту.

Также с навыком Алисы есть ещё большее ограничение на длину сообщения, если вызывать его через умную колонку. Если диктовать слишком много текста (дольше 10-15 сек), то колонка перестанет слушать. При этом навык ставится на паузу. Если колонку повторно вызвать "Алиса!", то запись последующего текста сообщения начнётся заново.
